<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Hello World</title>
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.7.3/pixi.js"></script>
<style>
  * {
    padding: 0;
    margin: 0
  }
</style>

<body>
<script type="text/javascript">
let type = "WebGL";
if (!PIXI.utils.isWebGLSupported()) {
  type = "canvas";
}

const WINSIZE = 800;
//Create a Pixi Appliplayerion
let app = new PIXI.Application({
  width: WINSIZE,
  height: WINSIZE,
  antialias: true,
  transparent: false,
  resolution: 1
});
app.renderer.view.style.position = "absolute";
app.renderer.view.style.display = "block";
app.renderer.autoResize = true;
if (window.innerWidth > window.innerHeight) {
  //PC
  app.renderer.view.style.height = "100%";
  app.renderer.view.style.width = "auto";
} else {
  app.renderer.view.style.height = "auto";
  app.renderer.view.style.width = "100%";
}

document.body.appendChild(app.view);

const Container = new PIXI.Container();
// マウス、タッチのイベントを拾えるようにする
Container.interactive = true;
// 画面の大きさでrectangleを設定
Container.hitArea = new PIXI.Rectangle(0, 0, WINSIZE, WINSIZE);
Container.on("pointerup", onClick);

Container.on("mousedown", onDragStart)
  .on("touchstart", onDragStart)
  .on("mouseup", onDragEnd)
  .on("mouseupoutside", onDragEnd)
  .on("touchend", onDragEnd)
  .on("touchendoutside", onDragEnd)
  .on("mousemove", onDragMove)
  .on("touchmove", onDragMove);

let dragging = false;
let exPosition = 0;
function onDragStart(e) {
  dragging = true;
  exPosition = e.data.global.x;
}

function onDragEnd() {
  dragging = false;
}

function onDragMove(e) {
  if (dragging) {
    player.x +=
      (e.data.global.x - exPosition) * (app.view.clientWidth / WINSIZE);
    exPosition = e.data.global.x;
  }
}
app.stage.addChild(Container);

PIXI.loader.add("1f603.png").load(setup);
let player, shell;

function setup() {
  //Create the player sprite
  player = new PIXI.Sprite(PIXI.loader.resources["1f603.png"].texture);
  player.x = WINSIZE / 2 - player.width / 2;
  player.y = WINSIZE - player.height - 10;

  shell = new PIXI.Sprite(PIXI.loader.resources["1f603.png"].texture);
  shell.width = 5;
  shell.height = 10;

  //Add the player to the stage
  app.stage.addChild(player);
  app.ticker.add(delta => gameLoop(delta));
}

const shellSpeed = 10;
function gameLoop(delta) {
  if (shell.parent) {
    console.log(shell.y);
    shell.y -= shellSpeed;
    if (shell.y < 0) {
      app.stage.removeChild(shell);
    }
  }
}

function onClick() {
  console.log(shell);
  if (!shell.parent) {
    shell.y = player.y;
    shell.x = player.x + player.width / 2;
    app.stage.addChild(shell);
    console.log(shell.x);
  }
}
</script>
</body>

</html>
